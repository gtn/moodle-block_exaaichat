{"version":3,"file":"block_instance_config.min.js","sources":["../src/block_instance_config.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Functions for the block configuration popup\n *\n * @module     block_exaaichat\n * @copyright  2025 GTN Solutions https://gtn-solutions.com\n * @copyright  based on work by Limekiller https://github.com/Limekiller/moodle-block_openai_chat\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport {getString} from 'core/str';\n\n/**\n * init function, which is called when the instance form is displayed\n */\nexport function init() {\n  const $form = $('input[type=\"hidden\"][value=\"exaaichat\"]').closest('form');\n\n  // api type select\n  const $select = $form.find('select[name=\"config_api_type\"]');\n  const oldValue = $select.val();\n\n  $select.on('change', async function () {\n    if (!confirm(await getString('block_instance:config:api_type:change', 'block_exaaichat'))) {\n      // Revert to old value\n      $select.val(oldValue);\n    } else {\n      // submit the form (click the submit button, so all moodle form handlers are called)\n      let submitbutton = $form.find('input[name=\"submitbutton\"]');\n      if (submitbutton.length) {\n        // moodle formular\n        submitbutton[0].click();\n      } else {\n        // im popup\n        $form.closest('.modal-content').find(':button[data-action=\"save\"]')[0].click();\n      }\n    }\n  });\n\n  // placeholder fÃ¼r system message\n  const $addPlaceholderBtn = $form.find(\"#config_add_placeholder_button\");\n  const $placeholderDropdown = $form.find(\"#config_placeholder_dropdown\");\n  // Info: using the name of the field, because the element id iscreated dynamically by moodle\n  const $messageTextarea = $form.find('textarea[name=\"config_sourceoftruth\"]');\n\n  if ($addPlaceholderBtn.length) {\n    // enable button (was disabled in form config by default)\n    $addPlaceholderBtn.prop('disabled', false);\n    $addPlaceholderBtn.click(async () => {\n      $messageTextarea.val($messageTextarea.val() + ($messageTextarea.val() ? \"\\n\" : \"\") + $placeholderDropdown.val());\n\n      // scroll to bottom of the textarea\n      $messageTextarea[0].scrollTo({\n        top: $messageTextarea[0].scrollHeight,\n        behavior: 'smooth'\n      });\n    });\n  }\n}\n"],"names":["$form","closest","$select","find","oldValue","val","on","async","confirm","submitbutton","length","click","$addPlaceholderBtn","$placeholderDropdown","$messageTextarea","prop","scrollTo","top","scrollHeight","behavior"],"mappings":";;;;;;;;4FA+BQA,OAAQ,mBAAE,2CAA2CC,QAAQ,QAG7DC,QAAUF,MAAMG,KAAK,kCACrBC,SAAWF,QAAQG,MAEzBH,QAAQI,GAAG,UAAUC,oBACdC,cAAc,kBAAU,wCAAyC,oBAG/D,KAEDC,aAAeT,MAAMG,KAAK,8BAC1BM,aAAaC,OAEfD,aAAa,GAAGE,QAGhBX,MAAMC,QAAQ,kBAAkBE,KAAK,+BAA+B,GAAGQ,aATzET,QAAQG,IAAID,mBAeVQ,mBAAqBZ,MAAMG,KAAK,kCAChCU,qBAAuBb,MAAMG,KAAK,gCAElCW,iBAAmBd,MAAMG,KAAK,yCAEhCS,mBAAmBF,SAErBE,mBAAmBG,KAAK,YAAY,GACpCH,mBAAmBD,OAAMJ,UACvBO,iBAAiBT,IAAIS,iBAAiBT,OAASS,iBAAiBT,MAAQ,KAAO,IAAMQ,qBAAqBR,OAG1GS,iBAAiB,GAAGE,SAAS,CAC3BC,IAAKH,iBAAiB,GAAGI,aACzBC,SAAU"}